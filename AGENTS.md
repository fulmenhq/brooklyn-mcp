# AGENTS.md: Guidelines for Agentic Coding in fulmen-mcp-forge-brooklyn

## Project Overview

Brooklyn is a multi-team MCP server for browser automation using Bun, TypeScript, and Playwright. Follow fulmen ecosystem standards in docs/fulmen/.

## Build/Lint/Test Commands

- Build: bun run build
- Lint: bun run lint
- Typecheck: bun run typecheck
- Test all: bun run test (vitest - NEVER bun test)
- Test single file: bun run test path/to/test.ts
- Test specific test: bun run test -t "test name"
- Format: bun run format:code
- File check: bun run check:file path/to/file.ts (mandatory after edits)
- Check all: bun run check-all (run before commits)
- Version bump: bun run version:bump:patch (NEVER edit VERSION/package.json manually)

## AI Agent Commit Attribution

AI agent commits should use this format:

```
Generated by [AI Agent Name] under supervision of @[human-maintainer]

Co-Authored-By: [AI Agent Name] <noreply@fulmen.ai>
```

Example:

```
Generated by Paris Brooklyn under supervision of @3leapsdave

Co-Authored-By: Paris Brooklyn <noreply@fulmen.ai>
```

## AI Agent Communication Standards

### Email Signature Format

```
---
[AI Agent Name]
AI Co-Maintainer, Fulmen MCP Forge Brooklyn
Supervised by @[human-maintainer]
[agent-name]@fulmenhq.com
```

### Chat/Mattermost Signature Format

```
‚Äî[AI Agent Name] (AI Co-Maintainer supervised by @[human-maintainer])
```

### GitHub Communication Format

```
---
*[AI Agent Name] - AI Co-Maintainer supervised by @[human-maintainer]*
```

### Communication Requirements

- **Always identify as AI agent** in first contact with new team members
- **Include supervision attribution** in all formal communications
- **Use consistent signatures** across email, chat, GitHub, and other platforms
- **Maintain transparency** about AI nature while being professional
- **Defer to human supervisor** for policy decisions and governance matters

## Code Style Guidelines

- **Imports**: Node built-ins ‚Üí Third-party ‚Üí Local (blank lines); use `import type`; absolute paths
- **Formatting**: Biome & Prettier; double quotes for strings, backticks for templates only
- **Types**: Strict TS; NO `any` (use unknown); optional chaining over !; Promise<Return | undefined>
- **Naming**: camelCase vars/functions, PascalCase classes/types; \_ for unused params
- **Error Handling**: Structured logging; try-catch for async; no silent failures; error boundaries
- **General**: Template literals; process.env["VAR"]; single responsibility; JSDoc for APIs
- **Testing**: AAA pattern; independent tests; 80%+ coverage; proper mocks; vitest only
- **Security**: Domain validation, rate limiting, team isolation
- **Cursor/Copilot Rules**: None found - follow above standards

## Development Standards

- Source-first: Review existing code before changes
- Pattern consistency: Follow codebase patterns
- Quality gates: All checks must pass; no bypassing
- MCP Compliance: Strict protocol adherence
- Resource Mgmt: Browser pooling, cleanup

## üö® CRITICAL: Logger Initialization Pattern (WILL BREAK BUNDLED APPS)

**THIS IS THE #1 CAUSE OF BUNDLED BINARY FAILURES**

### ‚ùå NEVER DO THIS - Module-Level Logger

```typescript
import { getLogger } from "../shared/structured-logger.js";
const logger = getLogger("my-module"); // üí• EXECUTES DURING BUNDLE!
```

### ‚úÖ ALWAYS DO THIS - Lazy Logger Pattern

```typescript
let logger: ReturnType<typeof getLogger> | null = null;
function ensureLogger() {
  if (!logger) {
    logger = getLogger("my-module");
  }
  return logger;
}
// Use: ensureLogger().info("Safe!");
```

**See docs/development/logging_and_telemetry_guide.md for full details**

## Pre-Commit Quality Gates (MANDATORY)

**ZERO-TOLERANCE POLICY**: All quality gates must pass before commit. Only maintainer can approve `--no-verify` for emergency situations.

### Required Checks (All Must Pass)

```bash
# 1. Code quality and tests
bun run check-all                    # Format, typecheck, lint, tests (100/100)

# 2. Build and install
bun run build                        # Must complete without errors
bun run install                      # Global CLI installation must succeed

# 3. Functional verification
brooklyn status                      # CLI must be functional
bun run dev:brooklyn:start           # Local dev mode must start
bun run dev:brooklyn:stop            # Local dev mode must stop cleanly
```

### Commit Approval Criteria

- ‚úÖ **Code Quality**: All linting, formatting, type checking passes
- ‚úÖ **Test Suite**: 100% test pass rate (no skipped/failing tests)
- ‚úÖ **Build Success**: Clean build with no errors or warnings
- ‚úÖ **CLI Functional**: `brooklyn status` and basic commands work
- ‚úÖ **Dev Mode**: Local development mode starts/stops correctly
- ‚úÖ **Attribution Format**: Must follow Fulmen Spark attribution standards (see below)

## üöÄ Fulmen Spark Commit Attribution Standards

**MANDATORY**: All AI agent commits must use the standardized Fulmen attribution format.

### Required Format

```
<type>: <description>

<body with bullet points describing changes>

Generated by Paris Brooklyn under supervision of @3leapsdave

Co-Authored-By: Paris Brooklyn <noreply@fulmen.ai>
```

### Example Commit Message

```
feat: Add user authentication middleware

- Implement JWT token validation
- Add rate limiting for auth endpoints
- Create user session management
- Update API documentation

Generated by Paris Brooklyn under supervision of @3leapsdave

Co-Authored-By: Paris Brooklyn <noreply@fulmen.ai>
```

### Attribution Requirements

1. **Conventional Commit Type**: `feat:`, `fix:`, `docs:`, `chore:`, etc.
2. **Clear Description**: Concise summary of changes
3. **Bullet Point Body**: List of specific changes made
4. **AI Attribution Line**: `Generated by Paris Brooklyn under supervision of @3leapsdave`
5. **Co-Author Line**: `Co-Authored-By: Paris Brooklyn <noreply@fulmen.ai>`

### ‚ùå Do NOT Use These Formats

**Generic Claude Code Format** (Deprecated):

```
ü§ñ Generated with [Claude Code](https://claude.ai/code)

Co-Authored-By: Claude <noreply@anthropic.com>
```

**OpenCode Format** (Not applicable):

```
ü§ñ Generated with opencode

Co-Authored-By: opencode <noreply@opencode.ai>
```

### ‚úÖ Always Use Fulmen Format

- **AI Agent Name**: "Paris Brooklyn" (full project identity)
- **Supervision**: "@3leapsdave" (human maintainer GitHub handle)
- **Email Domain**: `noreply@fulmen.ai` (Fulmen standard)
- **Consistency**: Same name and format across all commits

### Validation Checklist

Before committing, verify:

- [ ] Conventional commit type used (`feat:`, `fix:`, etc.)
- [ ] Clear, descriptive commit message
- [ ] Bullet points describing specific changes
- [ ] "Generated by Paris Brooklyn under supervision of @3leapsdave" line
- [ ] "Co-Authored-By: Paris Brooklyn <noreply@fulmen.ai>" line
- [ ] No generic Claude/OpenCode attribution used

### Emergency Override

**Only maintainer (@3leapsdave) can approve**:

```bash
git commit --no-verify -m "Emergency commit - [reason]"
```

**Reference**: See `docs/fulmen/spark/commit-attribution.md` for complete Fulmen Spark standards.

**Note**: Read source first, run quality gates before commits. See docs/substaile/codex/ for details. For onboarding, see CLAUDE.md.
