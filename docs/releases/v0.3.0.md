---
**Release Date**: 2025-12-??
**Release Type**: Feature Release â€“ HTTP Transport Hardening
**Status**: ðŸš§ In Progress (Auth Guard ready for merge)
---

## Overview

Brooklyn v0.3.0 introduces end-to-end authentication for the streamable HTTP transport. `brooklyn web start` now enforces bearer tokens issued by the existing OAuth flow, while still allowing explicit localhost/CI bypass modes. These changes unblock additional HTTP-based agents (Kilocode, Cursor HTTP, OpenCode) by delivering a consistent security story across transports.

---

## What's New

### HTTP Auth Guard

- Centralized guard (`src/transports/http-auth-guard.ts`) protects JSON-RPC, SSE, and tooling endpoints.
- Supports three explicit modes: `required`, `localhost`, `disabled`.
- Trusted proxy allowlist (`BROOKLYN_HTTP_TRUSTED_PROXIES`) ensures correct client IP detection behind load balancers.
- Successful authentication attaches `{ userId, teamId }` to the request context for future per-team enforcement.

### CLI & Config Updates

- `brooklyn web start` defaults to `--auth-mode required` and accepts overrides plus env vars.
- `brooklyn mcp dev-http` keeps `disabled` by default but can opt-in to `required` for CI validation.
- Configuration schema + parser now persist `authMode`, `trustedProxies`, and custom `tokenResolver` hooks.
- `.mcp.json`, `opencode.json`, and Codex TOML examples show how to reference HTTP transports safely.

### Testing

- **Unit**: Guard logic, transport metadata propagation, and CLI parsing.
- **Integration**: Live transport test proving 401 vs 200 flows when bearer tokens are missing/present.
- **Docs**: Updated quick starts remind users to run `--auth-mode localhost` only for loopback prototyping.

### Documentation

- README, CLI guide, HTTP mode API, and deployment guide explain auth modes, env vars, and bypass scenarios.
- New property-file appendix details the syntax for `.mcp.json`, `opencode.json`, and `~/.codex/config.toml` entries.
- Feature brief updated to mark transport, CLI, docs, and test deliverables as complete.

---

## Quality Metrics (current snapshot)

- Tests: HTTP auth additions covered by 33 existing transport specs + 2 new suites (unit + integration).
- Lint/format/typecheck: `bun run check:file` run per touched area; full `bun run check-all` required before release cut.
- Manual verification: Claude Code + OpenCode HTTP flows validated with bearer tokens on macOS.

---

## Breakage & Compatibility

- Default behavior changes: `brooklyn web start` now rejects unauthenticated HTTP traffic. Use `--auth-mode localhost` or `--auth-mode disabled` (CI only) to mimic legacy behavior.
- No changes to stdio transport.

---

## Migration Notes

1. **Developers**: Update local scripts to pass `--auth-mode localhost` if you relied on anonymous HTTP during prototyping.
2. **Operators**: Configure `BROOKLYN_HTTP_TRUSTED_PROXIES` when running behind TLS terminators.
3. **Clients**: Regenerate property files via `brooklyn config agent --client <name> --transport http --apply` to capture the latest recommended settings.

---

## Open Work for v0.3.0

- Persistent token issuance + revocation (postponed to v0.3.x).
- HTTP compatibility expansion (Kilocode streamable transport) pending Architect Brooklynâ€™s audit.
- Full `bun run check-all` + release checklist execution prior to tagging.

---

## References

- [Deployment Guide](../deployment/mcp-configuration.md#client-property-files)
- [HTTP Mode API](../development/http-mode-api.md#authentication-modes--trusted-proxies)
- [Changelog](../../CHANGELOG.md)
